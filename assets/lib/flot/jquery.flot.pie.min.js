(function(d){function c(C){function D(g,l,h){H||(H=!0,B=g.getCanvas(),F=d(B).parent(),a=g.getOptions(),g.setData(L(g.getData())))}function L(l){var x=0,p=0,m=0,w=a.series.pie.combine.color,h=[];for(var g=0;g<l.length;++g){var v=l[g].data;d.isArray(v)&&v.length==1&&(v=v[0]),d.isArray(v)?!isNaN(parseFloat(v[1]))&&isFinite(v[1])?v[1]=+v[1]:v[1]=0:!isNaN(parseFloat(v))&&isFinite(v)?v=[1,+v]:v=[1,0],l[g].data=[v]}for(var g=0;g<l.length;++g){x+=l[g].data[0][1]}for(var g=0;g<l.length;++g){var v=l[g].data[0][1];v/x<=a.series.pie.combine.threshold&&(p+=v,m++,w||(w=l[g].color))}for(var g=0;g<l.length;++g){var v=l[g].data[0][1];(m<2||v/x>a.series.pie.combine.threshold)&&h.push({data:[[1,v]],color:l[g].color,label:l[g].label,angle:v*Math.PI*2/x,percent:v/(x/100)})}return m>1&&h.push({data:[[1,p]],color:w,label:a.series.pie.combine.label,angle:p*Math.PI*2/x,percent:p/(x/100)}),h}function t(l,S){function E(){M.clearRect(0,0,o,m),F.children().filter(".pieLabel, .pieLabelBackground").remove()}function N(){var v=a.series.pie.shadow.left,g=a.series.pie.shadow.top,y=10,p=a.series.pie.shadow.alpha,h=a.series.pie.radius>1?a.series.pie.radius:z*a.series.pie.radius;if(h>=o/2-v||h*a.series.pie.tilt>=m/2-g||h<=y){return}M.save(),M.translate(v,g),M.globalAlpha=p,M.fillStyle="#000",M.translate(P,K),M.scale(1,a.series.pie.tilt);for(var w=1;w<=y;w++){M.beginPath(),M.arc(0,0,h,0,Math.PI*2,!1),M.fill(),h-=w}M.restore()}function Q(){function g(T,s,r){if(T<=0||isNaN(T)){return}r?M.fillStyle=s:(M.strokeStyle=s,M.lineJoin="round"),M.beginPath(),Math.abs(T-Math.PI*2)>1e-9&&M.moveTo(0,0),M.arc(0,0,y,v,v+T/2,!1),M.arc(0,0,y,v+T/2,v+T,!1),M.closePath(),v+=T,r?M.fill():M.stroke()}function w(){function T(ai,r,ak){if(ai.data[0][1]==0){return !0}var ah=a.legend.labelFormatter,Y,ac=a.series.pie.label.formatter;ah?Y=ah(ai.label,ai):Y=ai.label,ac&&(Y=ac(Y,ai));var ab=(r+ai.angle+r)/2,ag=P+Math.round(Math.cos(ab)*V),X=K+Math.round(Math.sin(ab)*V)*a.series.pie.tilt,aa="<span class='pieLabel' id='pieLabel"+ak+"' style='position:absolute;top:"+X+"px;left:"+ag+"px;'>"+Y+"</span>";F.append(aa);var ae=F.children("#pieLabel"+ak),ad=X-ae.height()/2,af=ag-ae.width()/2;ae.css("top",ad),ae.css("left",af);if(0-ad>0||0-af>0||m-(ad+ae.height())<0||o-(af+ae.width())<0){return !1}if(a.series.pie.label.background.opacity!=0){var aj=a.series.pie.label.background.color;aj==null&&(aj=ai.color);var Z="top:"+ad+"px;left:"+af+"px;";d("<div class='pieLabelBackground' style='position:absolute;width:"+ae.width()+"px;height:"+ae.height()+"px;"+Z+"background-color:"+aj+";'></div>").css("opacity",a.series.pie.label.background.opacity).insertBefore(ae)}return !0}var W=h,V=a.series.pie.label.radius>1?a.series.pie.label.radius:z*a.series.pie.label.radius;for(var U=0;U<R.length;++U){if(R[U].percent>=a.series.pie.label.threshold*100&&!T(R[U],W,U)){return !1}W+=R[U].angle}return !0}var h=Math.PI*a.series.pie.startAngle,y=a.series.pie.radius>1?a.series.pie.radius:z*a.series.pie.radius;M.save(),M.translate(P,K),M.scale(1,a.series.pie.tilt),M.save();var v=h;for(var p=0;p<R.length;++p){R[p].startAngle=v,g(R[p].angle,R[p].color,!0)}M.restore();if(a.series.pie.stroke.width>0){M.save(),M.lineWidth=a.series.pie.stroke.width,v=h;for(var p=0;p<R.length;++p){g(R[p].angle,a.series.pie.stroke.color,!1)}M.restore()}return G(M),M.restore(),a.series.pie.label.show?w():!0}if(!F){return}var o=l.getPlaceholder().width(),m=l.getPlaceholder().height(),x=F.children().filter(".legend").children().width()||0;M=S,H=!1,z=Math.min(o,m/a.series.pie.tilt)/2,K=m/2+a.series.pie.offset.top,P=o/2,a.series.pie.offset.left=="auto"?a.legend.position.match("w")?P+=x/2:P-=x/2:P+=a.series.pie.offset.left,P<z?P=z:P>o-z&&(P=o-z);var R=l.getData(),u=0;do{u>0&&(z*=f),u+=1,E(),a.series.pie.tilt<=0.8&&N()}while(!Q()&&u<b);u>=b&&(E(),F.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),l.setSeries&&l.insertLegend&&(l.setSeries(R),l.insertLegend())}function G(h){if(a.series.pie.innerRadius>0){h.save();var g=a.series.pie.innerRadius>1?a.series.pie.innerRadius:z*a.series.pie.innerRadius;h.globalCompositeOperation="destination-out",h.beginPath(),h.fillStyle=a.series.pie.stroke.color,h.arc(0,0,g,0,Math.PI*2,!1),h.fill(),h.closePath(),h.restore(),h.save(),h.beginPath(),h.strokeStyle=a.series.pie.stroke.color,h.arc(0,0,g,0,Math.PI*2,!1),h.stroke(),h.closePath(),h.restore()}}function J(o,h){for(var p=!1,m=-1,g=o.length,l=g-1;++m<g;l=m){(o[m][1]<=h[1]&&h[1]<o[l][1]||o[l][1]<=h[1]&&h[1]<o[m][1])&&h[0]<(o[l][0]-o[m][0])*(h[1]-o[m][1])/(o[l][1]-o[m][1])+o[m][0]&&(p=!p)}return p}function k(ah,X){var ac=C.getData(),af=C.getOptions(),Y=af.series.pie.radius>1?af.series.pie.radius:z*af.series.pie.radius,ab,ae;for(var ag=0;ag<ac.length;++ag){var aa=ac[ag];if(aa.pie.show){M.save(),M.beginPath(),M.moveTo(0,0),M.arc(0,0,Y,aa.startAngle,aa.startAngle+aa.angle/2,!1),M.arc(0,0,Y,aa.startAngle+aa.angle/2,aa.startAngle+aa.angle,!1),M.closePath(),ab=ah-P,ae=X-K;if(M.isPointInPath){if(M.isPointInPath(ah-P,X-K)){return M.restore(),{datapoint:[aa.percent,aa.data],dataIndex:0,series:aa,seriesIndex:ag}}}else{var ai=Y*Math.cos(aa.startAngle),V=Y*Math.sin(aa.startAngle),ad=Y*Math.cos(aa.startAngle+aa.angle/4),Q=Y*Math.sin(aa.startAngle+aa.angle/4),aj=Y*Math.cos(aa.startAngle+aa.angle/2),U=Y*Math.sin(aa.startAngle+aa.angle/2),W=Y*Math.cos(aa.startAngle+aa.angle/1.5),r=Y*Math.sin(aa.startAngle+aa.angle/1.5),R=Y*Math.cos(aa.startAngle+aa.angle),g=Y*Math.sin(aa.startAngle+aa.angle),u=[[0,0],[ai,V],[ad,Q],[aj,U],[W,r],[R,g]],Z=[ab,ae];if(J(u,Z)){return M.restore(),{datapoint:[aa.percent,aa.data],dataIndex:0,series:aa,seriesIndex:ag}}}M.restore()}}return null}function O(g){A("plothover",g)}function q(g){A("plotclick",g)}function A(o,w){var g=C.offset(),x=parseInt(w.pageX-g.left),v=parseInt(w.pageY-g.top),r=k(x,v);if(a.grid.autoHighlight){for(var m=0;m<I.length;++m){var h=I[m];h.auto==o&&(!r||h.series!=r.series)&&n(h.series)}}r&&i(r.series,o);var p={pageX:w.pageX,pageY:w.pageY};F.trigger(o,[p,r])}function i(h,g){var l=e(h);l==-1?(I.push({series:h,auto:g}),C.triggerRedrawOverlay()):g||(I[l].auto=!1)}function n(h){h==null&&(I=[],C.triggerRedrawOverlay());var g=e(h);g!=-1&&(I.splice(g,1),C.triggerRedrawOverlay())}function e(h){for(var g=0;g<I.length;++g){var l=I[g];if(l.series==h){return g}}return -1}function j(o,h){function l(r){if(r.angle<=0||isNaN(r.angle)){return}h.fillStyle="rgba(255, 255, 255, "+p.series.pie.highlight.opacity+")",h.beginPath(),Math.abs(r.angle-Math.PI*2)>1e-9&&h.moveTo(0,0),h.arc(0,0,m,r.startAngle,r.startAngle+r.angle/2,!1),h.arc(0,0,m,r.startAngle+r.angle/2,r.startAngle+r.angle,!1),h.closePath(),h.fill()}var p=o.getOptions(),m=p.series.pie.radius>1?p.series.pie.radius:z*p.series.pie.radius;h.save(),h.translate(P,K),h.scale(1,p.series.pie.tilt);for(var g=0;g<I.length;++g){l(I[g].series)}G(h),h.restore()}var B=null,F=null,z=null,P=null,K=null,H=!1,M=null,I=[];C.hooks.processOptions.push(function(h,g){g.series.pie.show&&(g.grid.show=!1,g.series.pie.label.show=="auto"&&(g.legend.show?g.series.pie.label.show=!1:g.series.pie.label.show=!0),g.series.pie.radius=="auto"&&(g.series.pie.label.show?g.series.pie.radius=0.75:g.series.pie.radius=1),g.series.pie.tilt>1?g.series.pie.tilt=1:g.series.pie.tilt<0&&(g.series.pie.tilt=0))}),C.hooks.bindEvents.push(function(h,g){var l=h.getOptions();l.series.pie.show&&(l.grid.hoverable&&g.unbind("mousemove").mousemove(O),l.grid.clickable&&g.unbind("click").click(q))}),C.hooks.processDatapoints.push(function(m,h,o,l){var g=m.getOptions();g.series.pie.show&&D(m,h,o,l)}),C.hooks.drawOverlay.push(function(h,g){var l=h.getOptions();l.series.pie.show&&j(h,g)}),C.hooks.draw.push(function(h,g){var l=h.getOptions();l.series.pie.show&&t(h,g)})}var b=10,f=0.95,a={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(h,g){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+g.color+";'>"+h+"<br/>"+Math.round(g.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};d.plot.plugins.push({init:c,options:a,name:"pie",version:"1.1"})})(jQuery);